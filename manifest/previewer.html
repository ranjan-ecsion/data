<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wedding Invitation Preview</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Yet Another React Lightbox CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/yet-another-react-lightbox@3.12.13/styles.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/yet-another-react-lightbox@3.12.13/plugins/thumbnails/thumbnails.css">
    <style>
        @keyframes shimmer {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .mobile-view-progress-bar-container {
            position: fixed;
            top: 8px;
            left: 15px;
            right: 15px;
            z-index: 1002;
            pointer-events: none;
        }

        .desktop-view-progress-bar-container {
            position: fixed;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 700px;
            z-index: 1002;
            pointer-events: none;
        }

        .header-container {
            position: absolute;
            top: 0;
            width: 100%;
            height: 80px;
            background-color: rgba(255, 255, 255, 0.21);
            z-index: 1001;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 10px 10px 10px;
            pointer-events: auto;
        }

        .desktop-header-container {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 700px;
            height: 70px;
            background-color: rgba(255, 255, 255, 0.21);
            z-index: 1001;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 10px 10px 10px;
        }

        .media-container {
            flex: 1;
            width: 100%;
            min-height: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        .desktop-media-container {
            width: 100%;
            max-width: 100%;
            height: auto;
            aspect-ratio: 3/4;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #f5f5f5;
            background-size: 400% 400%;
            animation: shimmer 3s ease infinite;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.6);
            position: relative;
        }

        .navigation-arrows {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 680px;
            z-index: 999;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 2px;
        }

        .btn-none {
            background: none;
            border: none;
            color: inherit;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #007bff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .swipe-hint {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 14px;
            z-index: 1000;
            animation: fadeInOut 3s ease-in-out;
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }

        .dropdown-menu {
            max-height: 300px;
            overflow-y: auto;
        }

        .music-btn, .slideshow-btn {
            background: rgba(255, 255, 255, 0.3);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .music-btn:hover, .slideshow-btn:hover {
            background: rgba(255, 255, 255, 0.5);
            transform: scale(1.1);
        }

        .card-media {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .video-media {
            width: 100%;
            height: 100%;
            background: #000;
        }

        .pdf-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Loading State -->
        <div id="loadingState" class="d-none justify-content-center align-items-center" style="height: 100vh; background: #fff;">
            <div class="text-center">
                <div class="loading-spinner mb-3"></div>
                <div style="font-weight: 500; color: #666;">Loading Preview...</div>
            </div>
        </div>

        <!-- Error State -->
        <div id="errorState" class="d-none justify-content-center">
            <div class="d-flex flex-column justify-content-center align-items-center" style="height: 100vh;">
                <div class="mb-4">
                    <img src="https://ecsiondevstorage.blob.core.windows.net/wedding-storage/F3BEF3C3-7A0D-46D8-BC12-44AFDAA781AB.png" 
                         width="180" height="100" class="h-auto" alt="Member Image">
                </div>
                <h5 class="fw-medium text-center mb-2">
                    The invitation you're trying to view isn't available.
                </h5>
                <p class="text-center text-muted mb-4">
                    It may have expired or been shared incorrectly.
                    Please contact the hosts for the updated link.
                </p>
            </div>
        </div>

        <!-- Main Preview -->
        <div id="previewContainer" class="d-none">
            <!-- Swipe Hint -->
            <div id="swipeHint" class="swipe-hint d-none">
                <i class="fas fa-arrows-left-right me-2"></i>Swipe to navigate
            </div>

            <!-- Background Audio -->
            <audio id="backgroundAudio" loop style="display: none;">
                <source src="https://ecsiondevstorage.blob.core.windows.net/wedding-storage/8145BBB1-4B25-4A5A-AD22-2614C7580EEC.mp3" type="audio/mpeg">
                Your browser does not support the audio element.
            </audio>

            <!-- Progress Bar -->
            <div id="progressBarContainer" class="mobile-view-progress-bar-container">
                <div style="height: 3px; border-radius: 2px; background-color: rgba(255, 255, 255, 0.3); overflow: hidden; position: relative;">
                    <div id="progressBar" style="height: 100%; background-color: var(--primary); width: 0%; transition: width 0.1s linear; border-radius: 2px;"></div>
                </div>
            </div>

            <!-- Header -->
            <div id="headerContainer" class="header-container px-3">
                <div id="dropdownContainer">
                    <div class="dropdown card-selection-dropdown">
                        <button class="btn btn-none dropdown-toggle d-flex align-items-center gap-2" 
                                type="button" id="cardSelectorDropdown" data-bs-toggle="dropdown">
                            <span id="currentCardName" class="flex-grow-1 text-truncate" style="font-size: 14px;"></span>
                        </button>
                        <ul id="dropdownMenu" class="dropdown-menu" style="min-width: 160px;"></ul>
                    </div>
                </div>

                <div class="d-flex align-items-center gap-2">
                    <button id="musicControl" class="music-btn d-none" title="Play Music">
                        <i class="fa-solid fa-volume-xmark"></i>
                    </button>
                    <button id="slideshowControl" class="slideshow-btn" title="Start Slideshow">
                        <i class="fa-solid fa-play"></i>
                    </button>
                </div>
            </div>

            <!-- Navigation Arrows (Desktop Only) -->
            <div id="navigationArrows" class="navigation-arrows d-none">
                <button class="btn btn-light left-move-btn" title="Previous Card">
                    <i class="fa-solid fa-chevron-left"></i>
                </button>
                <button class="btn btn-light right-move-btn" title="Next Card">
                    <i class="fa-solid fa-chevron-right"></i>
                </button>
            </div>

            <!-- Main Content -->
            <div id="mainContent" style="width: 100vw; height: 100vh; overflow-x: hidden; position: relative;">
                <div class="d-flex w-100 flex-column flex-lg-row" style="height: calc(100% - 0px);">
                    <div class="d-flex justify-content-center align-items-center flex-column flex-grow-1 col-preview-card" 
                         style="height: 100%; display: flex; flex-direction: column;">
                        <div id="mediaDisplay" class="media-container"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- JSZip for download functionality -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <script>
        class PreviewApp {
            constructor() {
                this.mobileCardsData = {};
                this.desktopCardsData = {};
                this.currentIndex = 0;
                this.isMobile = window.innerWidth < 992;
                this.orientation = window.innerWidth > window.innerHeight ? 'landscape' : 'portrait';
                this.isDownloading = false;
                this.isPlaying = false;
                this.isSlideshowActive = false;
                this.progress = 0;
                this.showMusicControl = false;
                this.cardEntries = [];
                this.slideshowTimer = null;

                this.initializeApp();
                this.bindEvents();
            }

            initializeApp() {
                this.checkEnvironment();
                this.setupResponsive();
                this.loadData();
            }

            bindEvents() {
                // Window resize
                window.addEventListener('resize', () => this.handleResize());

                // Music control
                document.getElementById('musicControl').addEventListener('click', () => this.toggleAudio());

                // Slideshow control
                document.getElementById('slideshowControl').addEventListener('click', () => this.toggleSlideshow());

                // Navigation arrows
                const prevBtn = document.querySelector('.left-move-btn');
                const nextBtn = document.querySelector('.right-move-btn');
                if (prevBtn && nextBtn) {
                    prevBtn.addEventListener('click', () => this.handlePrev());
                    nextBtn.addEventListener('click', () => this.handleNext());
                }

                // Touch events for mobile
                if (this.isMobile) {
                    const mainContent = document.getElementById('mainContent');
                    mainContent.addEventListener('touchstart', (e) => this.handleTouchStart(e));
                    mainContent.addEventListener('touchmove', (e) => this.handleTouchMove(e));
                    mainContent.addEventListener('touchend', () => this.handleTouchEnd());
                }
            }

            checkEnvironment() {
                const isReactNativeWebView = (
                    window.ReactNativeWebView ||
                    navigator.userAgent.includes("ReactNativeWebView") ||
                    navigator.userAgent.includes("wv") ||
                    (navigator.userAgent.includes("Android") && !navigator.userAgent.includes("Chrome")) ||
                    (navigator.userAgent.includes("Mobile") && navigator.userAgent.includes("Safari") && !navigator.userAgent.includes("Chrome"))
                );

                this.isWebView = isReactNativeWebView;
                this.isWebBrowser = !isReactNativeWebView;
            }

            setupResponsive() {
                this.updateLayout();
            }

            handleResize() {
                this.isMobile = window.innerWidth < 992;
                this.orientation = window.innerWidth > window.innerHeight ? 'landscape' : 'portrait';
                this.updateLayout();
                this.renderCurrentMedia();
            }

            updateLayout() {
                const progressContainer = document.getElementById('progressBarContainer');
                const headerContainer = document.getElementById('headerContainer');
                const navArrows = document.getElementById('navigationArrows');

                if (this.isMobile) {
                    progressContainer.className = 'mobile-view-progress-bar-container';
                    headerContainer.className = 'header-container px-3';
                    navArrows.classList.add('d-none');
                } else {
                    progressContainer.className = 'desktop-view-progress-bar-container';
                    headerContainer.className = 'desktop-header-container px-3';
                    if (this.cardEntries.length > 1) {
                        navArrows.classList.remove('d-none');
                    }
                }
            }

            async loadData() {
                this.showLoading();
                
                // For demo purposes, using static data
                // In real implementation, you would fetch from API
                setTimeout(() => {
                    this.mobileCardsData = {
                        "wedding_card": {
                            "error": null,
                            "status": "success",
                            "card_url": "https://ecsiondevstorage.blob.core.windows.net/wedding-storage/1EEA81FB-F625-4E6A-AA25-C4965104D9A7.mp4",
                            "timestamp": "2025-10-31T13:53:48.088Z",
                            "orientation": "portrait",
                        },
                        "Haldi-Mehendi": {
                            "error": null,
                            "status": "success",
                            "card_url": "https://ecsiondevstorage.blob.core.windows.net/wedding-storage/10B145A5-5195-4F1A-8BAC-923A641EA0D1.jpg",
                            "timestamp": "2025-10-31T13:53:48.088Z",
                            "orientation": "portrait",
                        },
                        "monogram_card": {
                            "error": null,
                            "status": "success",
                            "card_url": "https://ecsiondevstorage.blob.core.windows.net/wedding-storage/B61811EB-5603-47C0-8A18-5EEB537B5DD9.mp4",
                            "timestamp": "2025-10-31T13:53:48.088Z",
                            "orientation": "landscape",
                        },
                        "save_the_date": {
                            "error": null,
                            "status": "success",
                            "card_url": "https://ecsiondevstorage.blob.core.windows.net/wedding-storage/0B04037D-168D-4908-AD29-C440FC9565EB.jpg",
                            "timestamp": "2025-10-31T13:53:48.088Z",
                            "orientation": "landscape",
                        }
                    };

                    this.desktopCardsData = { ...this.mobileCardsData };
                    this.processCardData();
                    this.hideLoading();
                    this.showPreview();
                }, 1000);
            }

            processCardData() {
                const cardsData = this.isMobile ? this.mobileCardsData : this.desktopCardsData;
                const fixedOrder = [
                    "intro_card",
                    "ganeshvandna_card",
                    "monogram_card",
                    "wedding_card",
                    "save_the_date",
                ];

                const entries = Object.entries(cardsData);
                const fixedCards = [];
                const eventCards = [];

                entries.forEach(([key, value]) => {
                    if (fixedOrder.includes(key)) {
                        fixedCards.push([key, value]);
                    } else {
                        eventCards.push([key, value]);
                    }
                });

                fixedCards.sort(([keyA], [keyB]) => {
                    const indexA = fixedOrder.indexOf(keyA);
                    const indexB = fixedOrder.indexOf(keyB);
                    return indexA - indexB;
                });

                eventCards.sort(([keyA, valueA], [keyB, valueB]) => {
                    const orderA = valueA.order || 9999;
                    const orderB = valueB.order || 9999;
                    return orderA - orderB;
                });

                this.cardEntries = [];
                fixedCards.forEach(([key, value]) => {
                    if (key === "wedding_card") {
                        this.cardEntries.push([key, value]);
                        this.cardEntries.push(...eventCards);
                    } else {
                        this.cardEntries.push([key, value]);
                    }
                });

                this.updateDropdown();
                this.renderCurrentMedia();
            }

            updateDropdown() {
                const dropdownMenu = document.getElementById('dropdownMenu');
                const currentCardName = document.getElementById('currentCardName');
                
                dropdownMenu.innerHTML = '';
                currentCardName.textContent = this.getDisplayName(this.cardEntries[this.currentIndex]?.[0]);

                this.cardEntries.forEach(([key, value], index) => {
                    const listItem = document.createElement('li');
                    const link = document.createElement('a');
                    link.className = 'dropdown-item';
                    link.href = '#';
                    link.innerHTML = `
                        ${index === this.currentIndex ? '<i class="fa-solid fa-check text-primary" style="width: 16px;"></i>' : ''}
                        <span class="text-truncate" style="margin-left: ${index === this.currentIndex ? '0' : '16px'}">
                            ${this.getDisplayName(key)}
                        </span>
                    `;
                    
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        this.handleCardSelect(index);
                    });

                    listItem.appendChild(link);
                    dropdownMenu.appendChild(listItem);
                });
            }

            getDisplayName(key) {
                if (!key || typeof key !== "string") return "";
                const displayNames = {
                    ganeshvandna_card: "Ganeshvandna",
                    monogram_card: "Monogram",
                    wedding_card: "Wedding",
                    save_the_date: "Save the Date",
                };

                if (displayNames[key]) {
                    return displayNames[key];
                }

                if (key.includes("-")) {
                    return key
                        .split("-")
                        .map((event) => event.replace(/^event/i, "").trim())
                        .map((event) => event.charAt(0).toUpperCase() + event.slice(1))
                        .join(" - ");
                }

                return key
                    .replace(/_/g, " ")
                    .split(" ")
                    .map((word) => word.charAt(0).toUpperCase() + word.slice(1))
                    .join(" ");
            }

            isVideo(url) {
                return /\.(mp4|webm|ogg)$/i.test(url);
            }

            isPDF(url) {
                return /\.(pdf)$/i.test(url);
            }

            renderCurrentMedia() {
                const mediaDisplay = document.getElementById('mediaDisplay');
                const currentCard = this.cardEntries[this.currentIndex]?.[1];
                
                if (!currentCard) return;

                const url = currentCard.card_url;
                const cardOrientation = currentCard.orientation;
                const styles = this.getMediaStyles(cardOrientation);

                mediaDisplay.innerHTML = '';

                if (this.isVideo(url)) {
                    const videoContainer = document.createElement('div');
                    Object.assign(videoContainer.style, styles, { cursor: 'pointer' });
                    
                    const video = document.createElement('video');
                    video.src = url;
                    video.controls = !this.isMobile;
                    video.playsInline = true;
                    Object.assign(video.style, {
                        width: '100%',
                        height: '100%',
                        objectFit: 'contain'
                    });
                    
                    videoContainer.appendChild(video);
                    mediaDisplay.appendChild(videoContainer);
                } else if (this.isPDF(url)) {
                    const pdfContainer = document.createElement('div');
                    pdfContainer.className = 'pdf-container';
                    pdfContainer.innerHTML = `
                        <div style="font-size: 64px; margin-bottom: 20px;">ðŸ“„</div>
                        <h4 style="margin-bottom: 10px; font-weight: 600;">PDF Document</h4>
                        <p style="margin-bottom: 8px; opacity: 0.9;">${this.getDisplayName(this.cardEntries[this.currentIndex]?.[0])}</p>
                        <p style="margin-bottom: 20px; opacity: 0.8; font-size: 14px;">
                            ${this.isWebBrowser ? "Ready for download" : "View in browser to download"}
                        </p>
                        ${this.isWebBrowser ? `
                            <button class="btn btn-light d-flex align-items-center gap-2" onclick="app.downloadFile('${url}', '${this.getDisplayName(this.cardEntries[this.currentIndex][0])}.pdf')">
                                <span>ðŸ“¥</span> Download PDF
                            </button>
                        ` : ''}
                    `;
                    mediaDisplay.appendChild(pdfContainer);
                } else {
                    const imgContainer = document.createElement('div');
                    Object.assign(imgContainer.style, styles, { cursor: 'pointer' });
                    
                    const img = document.createElement('img');
                    img.src = url;
                    img.alt = "Selected Media";
                    img.className = 'card-media';
                    Object.assign(img.style, styles);
                    
                    imgContainer.appendChild(img);
                    mediaDisplay.appendChild(imgContainer);
                }
            }

            getMediaStyles(cardOrientation) {
                let rotation = 0;
                let width, height;

                if (this.isMobile && cardOrientation === "landscape") {
                    if (this.orientation === "portrait") {
                        rotation = 90;
                        width = "100vh";
                        height = "100vw";
                    } else {
                        rotation = 0;
                        width = "100vw";
                        height = "100vh";
                    }
                } else {
                    width = this.isMobile ? "100vw" : "calc(100% - 10px)";
                    height = "100vh";
                }

                const currentCard = this.cardEntries[this.currentIndex]?.[1] || {};
                const isVideoCard = this.isVideo(currentCard.card_url);

                return {
                    width,
                    height,
                    objectFit: this.isMobile ? "auto" : "contain",
                    background: isVideoCard ? "#000" : "transparent",
                    transform: rotation !== 0 ? `rotate(${rotation}deg)` : "none",
                    transformOrigin: "center center",
                    transition: "transform 0.3s ease, width 0.3s ease, height 0.3s ease",
                };
            }

            handleCardSelect(index) {
                this.currentIndex = index;
                this.updateDropdown();
                this.renderCurrentMedia();
                this.resetProgress();
            }

            handlePrev() {
                this.currentIndex = this.currentIndex > 0 ? this.currentIndex - 1 : this.cardEntries.length - 1;
                this.updateDropdown();
                this.renderCurrentMedia();
                this.resetProgress();
            }

            handleNext() {
                this.currentIndex = this.currentIndex < this.cardEntries.length - 1 ? this.currentIndex + 1 : 0;
                this.updateDropdown();
                this.renderCurrentMedia();
                this.resetProgress();
            }

            // Touch handlers
            handleTouchStart(e) {
                this.touchStartX = e.touches[0].clientX;
            }

            handleTouchMove(e) {
                this.touchEndX = e.touches[0].clientX;
            }

            handleTouchEnd() {
                if (!this.touchStartX || !this.touchEndX) return;

                const diff = this.touchStartX - this.touchEndX;
                const minSwipeDistance = 50;

                if (Math.abs(diff) >= minSwipeDistance) {
                    if (diff > 0) {
                        this.handleNext();
                    } else {
                        this.handlePrev();
                    }
                }

                this.touchStartX = 0;
                this.touchEndX = 0;
            }

            // Audio control
            toggleAudio() {
                const audio = document.getElementById('backgroundAudio');
                const musicIcon = document.querySelector('#musicControl i');

                try {
                    if (this.isPlaying) {
                        audio.pause();
                        this.isPlaying = false;
                        musicIcon.className = 'fa-solid fa-volume-xmark';
                    } else {
                        audio.volume = 0.7;
                        audio.play();
                        this.isPlaying = true;
                        musicIcon.className = 'fa-solid fa-volume-high';
                    }
                } catch (error) {
                    console.log("Audio playback failed:", error);
                }
            }

            // Slideshow control
            toggleSlideshow() {
                this.isSlideshowActive = !this.isSlideshowActive;
                const slideshowIcon = document.querySelector('#slideshowControl i');

                if (this.isSlideshowActive) {
                    slideshowIcon.className = 'fa-solid fa-pause';
                    this.showMusicControl = true;
                    document.getElementById('musicControl').classList.remove('d-none');
                    this.startSlideshow();
                } else {
                    slideshowIcon.className = 'fa-solid fa-play';
                    this.showMusicControl = false;
                    document.getElementById('musicControl').classList.add('d-none');
                    this.stopSlideshow();
                }
            }

            startSlideshow() {
                this.updateProgressBar(0);
                this.slideshowTimer = setInterval(() => {
                    this.progress += 1;
                    this.updateProgressBar(this.progress);

                    if (this.progress >= 100) {
                        if (this.currentIndex < this.cardEntries.length - 1) {
                            this.currentIndex++;
                        } else {
                            this.currentIndex = 0;
                        }
                        this.updateDropdown();
                        this.renderCurrentMedia();
                        this.progress = 0;
                    }
                }, 100);
            }

            stopSlideshow() {
                if (this.slideshowTimer) {
                    clearInterval(this.slideshowTimer);
                    this.slideshowTimer = null;
                }
                this.resetProgress();
            }

            updateProgressBar(progress) {
                const progressBar = document.getElementById('progressBar');
                progressBar.style.width = `${progress}%`;
            }

            resetProgress() {
                this.progress = 0;
                this.updateProgressBar(0);
            }

            // Download functionality
            async downloadFile(url, filename) {
                if (this.isWebView) {
                    alert("Download feature is available in web browser only.");
                    return;
                }

                try {
                    const response = await fetch(url);
                    const blob = await response.blob();
                    const blobUrl = window.URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = blobUrl;
                    link.download = filename;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    window.URL.revokeObjectURL(blobUrl);
                } catch (error) {
                    console.error("Download failed:", error);
                    alert("Download failed. Please try again.");
                }
            }

            // UI state management
            showLoading() {
                document.getElementById('loadingState').classList.remove('d-none');
                document.getElementById('errorState').classList.add('d-none');
                document.getElementById('previewContainer').classList.add('d-none');
            }

            hideLoading() {
                document.getElementById('loadingState').classList.add('d-none');
            }

            showPreview() {
                document.getElementById('previewContainer').classList.remove('d-none');
                
                // Show swipe hint on mobile
                if (this.isMobile) {
                    const swipeHint = document.getElementById('swipeHint');
                    swipeHint.classList.remove('d-none');
                    setTimeout(() => {
                        swipeHint.classList.add('d-none');
                    }, 3000);
                }
            }

            showError() {
                document.getElementById('loadingState').classList.add('d-none');
                document.getElementById('previewContainer').classList.add('d-none');
                document.getElementById('errorState').classList.remove('d-none');
            }
        }

        // Initialize the app when DOM is loaded
        let app;
        document.addEventListener('DOMContentLoaded', () => {
            app = new PreviewApp();
        });

        // Make app globally available for onclick handlers
        window.app = app;
    </script>
</body>
</html>